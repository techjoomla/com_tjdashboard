var TJDashboardUI={initDashboard:function(a){TJDashboardService.getDashboard(a).done(function(a){if(!a.data.dashboard_id)return!1;if(a.data.widget_data.length<=0)return jQuery('<div class="alert alert-info">'+Joomla.JText._("COM_TJDASHBOARD_WIDGETS_NOTSHOW_ERROR_MESSAGE")+"</div>").appendTo(".tjdashboard"),!1;var e=0,r=0,d=1;return jQuery('<div class="widget-boxes row dashboard-filter dashboard-widget-row-'+d+'">').appendTo(".tjdashboard"),jQuery.each(a.data.widget_data,function(i,t){var s="panel-default",n="",o="",l="",_="";if(t.params)try{t.params=JSON.parse(t.params),t.params.color&&(s=t.params.color),t.params.icon&&(n=t.params.icon),null!=t.params.filter&&1==t.params.filter&&(o=" filter-widget"),null!=t.params.grouping&&1==t.params.grouping&&(l=" dashboard-widget-label"),null!=t.params.titlelink&&""!==t.params.titlelink&&(_=t.params.titlelink)}catch(a){t.params={}}12===parseInt(t.size)&&d>1&&(d++,jQuery('</div><div class="widget-boxes row '+l+" dashboard-widget-row-"+d+'">').appendTo(".tjdashboard"),e=0);var u='<div class="col-sm-'+t.size+'"><div class="widget-data panel '+s+'"><div class="widget-title panel-heading"><span class="fs-20 pr-5 '+n+'" aria-hidden="true"></span>';""!=jQuery.trim(_)&&(u+='<a class="text-white title-link-'+t.dashboard_widget_id+'" href="'+Joomla.getOptions("system.paths").base+"/"+_+'">'),u+='<span class="ml-10 fs-18 font-600">'+t.title+"</span>",""!=jQuery.trim(_)&&(u+="</a>"),u+='<span id="view-all-'+t.dashboard_widget_id+'" class="pull-right"></span></div><div data-dashboard-widget-id="'+t.dashboard_widget_id+'" id="dashboard-widget-'+t.dashboard_widget_id+'" class="'+o+'"></div></div></div>',jQuery(u).appendTo(".dashboard-widget-row-"+d),jQuery("#dashboard-widget-"+t.dashboard_widget_id).html('<span class="loader-spin-blue"></span>'),TJDashboardUI.initWidget(t),r++,(e=parseInt(e)+parseInt(t.size))>=12&&a.data.widget_data.length!==r&&(d++,jQuery('</div><div class="widget-boxes row dashboard-widget-row-'+d+'">').appendTo(".tjdashboard"),e=0),a.data.widget_data.length===r&&jQuery("</div>").appendTo(".tjdashboard")}),!0})},initWidget:function(a,e=null){TJDashboardService.getWidget(a.dashboard_widget_id,e).done(function(e){if(!e.data.dashboard_widget_id)return jQuery('<div class="alert alert-info">'+Joomla.JText._("COM_TJDASHBOARD_NO_DATA_AVAILABLE_MESSAGE")+"</div>").appendTo("#dashboard-widget-"+a.dashboard_widget_id),!1;if(!TJDashboardUI._validWidget(e.data.widget_render_data)||0==e.data.widget_render_data.length)return jQuery('<div class="alert alert-info">'+Joomla.JText._("COM_TJDASHBOARD_NO_DATA_AVAILABLE_MESSAGE")+"</div>").appendTo("#dashboard-widget-"+e.data.dashboard_widget_id),!1;jQuery(window).trigger("resize");var r=[];r.element="dashboard-widget-"+e.data.dashboard_widget_id,r.data=e.data.widget_render_data,r.params=a.params;var d=e.data.renderer_plugin.split("."),i=d[0],t=d[1];if(!r&&!e.data.renderer_plugin)return!1;var s=[],n=0,o=JSON.parse(r.data),l="";if(o.links){n=o.links.length,s=o.links;for(var _=0;_<n;_++)l=l+' <a href="'+s[_].link+'">'+s[_].title+"</a> ";jQuery("#view-all-"+e.data.dashboard_widget_id).replaceWith('<span id="view-all-'+e.data.dashboard_widget_id+'" class="pull-right">'+l+"</span>")}var u="TJDashboard"+TJDashboardUI._jsUcFirst(i);return TJDashboardUI._addCssFiles(e.data.widget_css),TJDashboardUI._addJsFiles(e.data.widget_js,t,r,u),!0})},_addCssFiles:function(a){jQuery.each(a,function(a,e){var r=document.createElement("link");r.href=e,r.type="text/css",r.rel="stylesheet",0==jQuery.find("link [href='"+e+"']").length&&jQuery("head").append(r)})},_addJsFiles:function(a,e,r,d){jQuery.each(a,function(a,i){jQuery.getScript(i,function(){window[d].renderData(e,r)})})},_validWidget:function(a){try{JSON.parse(a)}catch(a){return!1}return!0},_jsUcFirst:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},_setRenderers:function(){var a=jQuery("#jform_data_plugin").val(),e=jQuery("#jform_renderer_plugin").val(),r=TJDashboardService.getRenderers(a);jQuery("#jform_renderer_plugin").replaceWith('<select id="jform_renderer_plugin" name="jform[renderer_plugin]" class="required" required="required" aria-required="true"><option value="">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_RENDERER_PLUGIN")+"</option></select>"),jQuery("#jform_renderer_plugin").find("option").not(":first").remove(),r.done(function(a){var r=jQuery("#jform_renderer_plugin");jQuery.each(a.data,function(a,e){r.append(new Option(e,a))}),jQuery("#jform_renderer_plugin").val(e)}),TJDashboardService.getWidgetParams(a).done(function(a){jQuery("#jform_params").val(a.data)})},_setSize:function(){var a=jQuery("#jform_size").val();jQuery("#jform_size").replaceWith('<select id="jform_size" name="jform[size]" class="inputbox required" required="required" aria-required="true"><option value="">Select Size</option><option value="12">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_FULL_WIDTH")+'</option><option value="6">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_HALF_WIDTH")+'</option><option value="4">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_ONE_THIRD_WIDTH")+'</option><option value="3">'+Joomla.JText._("COM_TJDASHBOARD_WIDGET_FORM_ONE_FOURTH_WIDTH")+"</option></select>"),jQuery("#jform_size").val(a)},widgetListener:function(){var a={dashboard_widget_id:0,params:""},e=jQuery(".widget-filters").serialize(),r=[],d="";jQuery(".filter-widget").each(function(){d=jQuery(this).data("dashboard-widget-id"),-1==jQuery.inArray(d,r)&&(jQuery("#dashboard-widget-"+d).html('<span class="loader-spin-blue"></span>'),r.push(d),a.dashboard_widget_id=d,TJDashboardUI.initWidget(a,e))})}};jQuery(document).on("change",".widget-filters",function(){TJDashboardUI.widgetListener()});
